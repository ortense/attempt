![Attempt banner - the attempt mascot generated by dall-e 2](https://raw.githubusercontent.com/ortense/attempt/main/media/mascot.png)

# @ortense/attempt
![npm](https://img.shields.io/npm/v/@ortense/attempt)
[![Coverage Status](https://coveralls.io/repos/github/ortense/attempt/badge.svg)](https://coveralls.io/github/ortense/attempt)
![Made with Love](https://img.shields.io/badge/Made%20with-%E2%9D%A4-red)

Uma biblioteca TypeScript minimalista para tratamento seguro de erros usando o padr√£o Result Type.

## Instala√ß√£o

```bash
npm install @ortense/attempt  # npm
yarn add  @ortense/attempt    # yarn
pnpm add @ortense/attempt     # pnpm
bun add @ortense/attempt      # bun
```

## Por que usar?

- üéØ **Type-safe**: Tratamento de erros com seguran√ßa de tipos
- üé® **Elegante**: API simples e expressiva
- üîí **Seguro**: Sem exce√ß√µes n√£o tratadas
- ü™∂ **Leve**: Zero depend√™ncias
- üì¶ **Pequeno**: Bundle size m√≠nimo
- üí™ **Robusto**: 100% testado

## Uso B√°sico

```typescript
import { attempt, attemptAsync } from '@ortense/attempt'

// C√≥digo s√≠ncrono
const result = attempt(() => {
  const number = parseInt("123")
  if (isNaN(number)) throw new Error("N√∫mero inv√°lido")
  return number
})

if (result.success) {
  console.log(result.value) // 123
} else {
  console.error(result.error) // Error
}

// C√≥digo ass√≠ncrono
const result = await attemptAsync(
  fetch("https://api.example.com/data")
    .then(response => response.json())
)

if (result.success) {
  console.log(result.value) // dados da API
} else {
  console.error(result.error.message) // "Falha na API"
}
```

## API

### Tipos

```typescript
type Success<T> = {
  success: true
  value: T
}

type Failure<E extends Error> = {
  success: false
  error: E
}

type Result<T, E extends Error> = Success<T> | Failure<E>
```

### Fun√ß√µes

#### `success<T>(value: T): Success<T>`
Cria um resultado de sucesso contendo um valor.

```typescript
const result = success(42)
// { success: true, value: 42 }
```

#### `failure<E extends Error>(error: unknown): Failure<E>`
Cria um resultado de falha contendo um erro.

```typescript
const result = failure(new Error("Algo deu errado"))
// { success: false, error: Error("Algo deu errado") }

// Strings s√£o convertidas para Error
const result = failure("Algo deu errado")
// { success: false, error: Error("Algo deu errado") }
```

#### `attempt<T, E extends Error>(fn: () => T): Result<T, E>`
Executa uma fun√ß√£o e captura qualquer erro lan√ßado.

```typescript
const result = attempt(() => {
  if (Math.random() > 0.5) throw new Error("Azar!")
  return "Sorte!"
})

if (result.success) {
  console.log(result.value) // "Sorte!"
} else {
  console.error(result.error) // Error("Azar!")
}
```

#### `attemptAsync<T, E extends Error>(Promise<T>): Promise<Result<T, E>>`
Resolve uma promise e captura qualquer erro lan√ßado.

```typescript
const result = await attemptAsync(
  fetch("https://api.example.com/data")
    .then(response.json())
)

if (result.success) {
  console.log(result.value) // dados da API
} else {
  console.error(result.error) // "Falha na API"
}
```

## Exemplos Avan√ßados

### Erros Customizados

```typescript
class ApiError extends Error {
  constructor(
    message: string,
    public statusCode: number
  ) {
    super(message)
    this.name = "ApiError"
  }
}

const result = attempt(() => {
  throw new ApiError("N√£o autorizado", 401)
})

if (!result.success) {
  console.log(result.error.statusCode) // 401
}
```

### Type Narrowing

```typescript
function processResult(result: Result<number, Error>) {
  if (result.success) {
    // TypeScript sabe que result.value √© number
    return result.value * 2
  } else {
    // TypeScript sabe que result.error √© Error
    return result.error.message
  }
}
```

### Composi√ß√£o de Opera√ß√µes

```typescript
const getUser = async (id: string) => {
  const result = await attemptAsync(
    fetch(`/api/users/${id}`)
      .then(response => {
        if (!response.ok) throw new Error("Usu√°rio n√£o encontrado")
        return response
      })
      .then(response => response.json())
  )

  if (!result.success) {
    return result // early return com o erro
  }

  // Processa apenas em caso de sucesso
  return attempt(() => {
    const user = result.value
    if (!user.active) throw new Error("Usu√°rio inativo")
    return user
  })
}

// Usando map para uma composi√ß√£o mais limpa
const getUserName = async (id: string) => {
  const result = await attemptAsync(
    fetch(`/api/users/${id}`)
      .then(response => {
        if (!response.ok) throw new Error("Usu√°rio n√£o encontrado")
        return response
      })
      .then(response => response.json())
  )

  return result.map(user => user.name)
}
```

## Licen√ßa

MIT ¬© [Marcus Ortense](https://github.com/ortense)