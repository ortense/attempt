![Functors banner - the attempt mascot generated by dall-e 2](https://raw.githubusercontent.com/ortense/attempt/main/media/mascot.png)

# @ortense/attempt

Uma biblioteca TypeScript minimalista para tratamento seguro de erros usando o padr√£o Result Type.

## Instala√ß√£o

```bash
npm install @ortense/attempt
```

## Por que usar?

- üéØ **Type-safe**: Tratamento de erros com seguran√ßa de tipos
- üé® **Elegante**: API simples e expressiva
- üîí **Seguro**: Sem exce√ß√µes n√£o tratadas
- ü™∂ **Leve**: Zero depend√™ncias
- üì¶ **Pequeno**: Bundle size m√≠nimo
- üí™ **Robusto**: 100% testado

## Uso B√°sico

```typescript
import { attempt, attemptAsync } from '@ortense/attempt'

// C√≥digo s√≠ncrono
const result = attempt(() => {
  const number = parseInt("123")
  if (isNaN(number)) throw new Error("N√∫mero inv√°lido")
  return number
})

if (result.success) {
  console.log(result.value) // 123
} else {
  console.error(result.error) // Error
}

// C√≥digo ass√≠ncrono
const result = await attemptAsync(async () => {
  const response = await fetch("https://api.example.com/data")
  if (!response.ok) throw new Error("Falha na API")
  return response.json()
})

if (result.success) {
  console.log(result.value) // dados da API
} else {
  console.error(result.error.message) // "Falha na API"
}
```

## API

### Tipos

```typescript
type Success<T> = {
  success: true
  value: T
}

type Failure<E extends Error> = {
  success: false
  error: E
}

type Result<T, E extends Error> = Success<T> | Failure<E>
```

### Fun√ß√µes

#### `success<T>(value: T): Success<T>`
Cria um resultado de sucesso contendo um valor.

```typescript
const result = success(42)
// { success: true, value: 42 }
```

#### `failure<E extends Error>(error: unknown): Failure<E>`
Cria um resultado de falha contendo um erro.

```typescript
const result = failure(new Error("Algo deu errado"))
// { success: false, error: Error("Algo deu errado") }

// Strings s√£o convertidas para Error
const result = failure("Algo deu errado")
// { success: false, error: Error("Algo deu errado") }
```

#### `attempt<T, E extends Error>(fn: () => T): Result<T, E>`
Executa uma fun√ß√£o e captura qualquer erro lan√ßado.

```typescript
const result = attempt(() => {
  if (Math.random() > 0.5) throw new Error("Azar!")
  return "Sorte!"
})

if (result.success) {
  console.log(result.value) // "Sorte!"
} else {
  console.error(result.error) // Error("Azar!")
}
```

#### `attemptAsync<T, E extends Error>(fn: () => Promise<T>): Promise<Result<T, E>>`
Executa uma fun√ß√£o ass√≠ncrona e captura qualquer erro lan√ßado.

```typescript
const result = await attemptAsync(async () => {
  const response = await fetch("https://api.example.com/data")
  if (!response.ok) throw new Error(`HTTP ${response.status}`)
  return response.json()
})

if (result.success) {
  console.log(result.value) // dados da API
} else {
  console.error(result.error) // Error("HTTP 404")
}
```

### M√©todos

#### `map<U>(fn: (value: T) => U): Result<U, E>`
Transforma o valor de sucesso usando uma fun√ß√£o de mapeamento. Se o resultado for uma falha, retorna a falha inalterada.

```typescript
const result = success(42)
  .map(n => n * 2)        // Result<84, never>
  .map(n => n.toString()) // Result<"84", never>
  .map(s => s + "!")      // Result<"84!", never>

// Falhas s√£o preservadas
const result = failure(new Error("oops"))
  .map(n => n * 2) // Continua sendo Failure<Error>
```

## Exemplos Avan√ßados

### Erros Customizados

```typescript
class ApiError extends Error {
  constructor(
    message: string,
    public statusCode: number
  ) {
    super(message)
    this.name = "ApiError"
  }
}

const result = attempt(() => {
  throw new ApiError("N√£o autorizado", 401)
})

if (!result.success) {
  console.log(result.error.statusCode) // 401
}
```

### Type Narrowing

```typescript
function processResult(result: Result<number, Error>) {
  if (result.success) {
    // TypeScript sabe que result.value √© number
    return result.value * 2
  } else {
    // TypeScript sabe que result.error √© Error
    return result.error.message
  }
}
```

### Composi√ß√£o de Opera√ß√µes

```typescript
const getUser = async (id: string) => {
  const result = await attemptAsync(async () => {
    const response = await fetch(`/api/users/${id}`)
    if (!response.ok) throw new Error("Usu√°rio n√£o encontrado")
    return response.json()
  })

  if (!result.success) {
    return result // early return com o erro
  }

  // Processa apenas em caso de sucesso
  return attempt(() => {
    const user = result.value
    if (!user.active) throw new Error("Usu√°rio inativo")
    return user
  })
}

// Usando map para uma composi√ß√£o mais limpa
const getUserName = async (id: string) => {
  const result = await attemptAsync(async () => {
    const response = await fetch(`/api/users/${id}`)
    if (!response.ok) throw new Error("Usu√°rio n√£o encontrado")
    return response.json()
  })

  return result.map(user => user.name)
}
```

## Licen√ßa

MIT ¬© [Marcus Ortense](https://github.com/ortense) 